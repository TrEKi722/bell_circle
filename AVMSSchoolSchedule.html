<!DOCTYPE html>
<html>
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap" rel="stylesheet">
  <style>
    body {
      text-align: center; /* Center justify text */
      font-family: "Titillium Web", sans-serif;
      font-weight: 400;
      font-style: normal;
    }
    .schedule {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .schedule-item {
      margin-bottom: 10px;
      margin-right: 45px;
      list-style-type: none; /* Remove bullet points */
      text-align: center; /* Center justify text */
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <div class="schedule">
    <h1 id="current-time"></h1>
    <h2 id="current-date"></h2>
    <h2 id="current-period"></h2>
    <p>Countdown to:</p>
    <p id="next-period"></p>
    <p id="countdown"></p>
    <h2>Today's Schedule:</h2>
    <ul id="schedule-list"></ul>
  </div>

  <script>
    const scheduleListElement = document.getElementById("schedule-list");
    const currentTimeElement = document.getElementById("current-time");
    const currentDateElement = document.getElementById("current-date");
    const currentPeriodElement = document.getElementById("current-period");
    const nextPeriodElement = document.getElementById("next-period");
    const countdownElement = document.getElementById("countdown");
    // Your personal access token and base ID
    const accessToken = 'patI5iaCYvQ3fOAWW';
    const baseId = 'app5kCLxN9sVAY9wA';
    const tableName = 'AVMS_MinDays';

    // Airtable endpoint URL
    const endpoint = `https://api.airtable.com/v0/${baseId}/${tableName}`;

    // Declare dateList outside the function scope
    let dateList = [];

    // Function to fetch data from Airtable and extract the "Date" column into a list
    async function fetchDateList() {
      try {
        const response = await axios.get(endpoint, {
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });
        dateList = response.data.records.map(record => record.fields.Date); // Extracting "Date" column
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    // Invoke the function when the page loads
    window.onload = async function() {
      await fetchDateList();
      console.log('Dates from Airtable:', dateList);
      // You can now access the dateList variable from outside the function
    };

    // Define the schedules for each day of the week
    const weeklySchedule = {
      "Monday": [
        { start: 9 * 60 + 45, end: 10 * 60 + 25, name: "First Period" },
        { start: 10 * 60 + 29, end: 11 * 60 + 9, name: "Second Period" },
        { start: 11 * 60 + 9, end: 11 * 60 + 21, name: "Break" },
        { start: 11 * 60 + 25, end: 12 * 60 + 5, name: "Third Period" },
        { start: 12 * 60 + 9, end: 12 * 60 + 49, name: "Fourth Period" },
        { start: 12 * 60 + 53, end: 13 * 60 + 22, name: "RISE" },
        { start: 13 * 60 + 22, end: 13 * 60 + 57, name: "Lunch" },
        { start: 14 * 60 + 1, end: 14 * 60 + 41, name: "Fifth Period" },
        { start: 14 * 60 + 45, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Tuesday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Wednesday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Thursday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Friday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      //... and so on for the rest of the week
    };

    // Get the current day of the week
    const now = new Date();
    let currentDay = now.toLocaleDateString("en-US", { weekday: "long" });

    // Gets the current date in ISO-8601 format
    const currentDate = now.toLocaleDateString("en-US", {year: "numeric"}) + "-" + now.toLocaleDateString("en-US", {month: "2-digit"}) + "-" + now.toLocaleDateString("en-US", {day: "2-digit"});

    for (let i = 0; i < dateList.length; i++) {
      if (dateList[i] === currentDate) {
        currentDay = "Minimum Day";
      }
    }

    // Get the schedule for the current day
    const currentSchedule = weeklySchedule[currentDay];

    // Update the current time every second
    setInterval(() => {
      const now = new Date();
      const options = { hour: "2-digit", minute: "2-digit", second: "2-digit" };
      currentTimeElement.textContent = now.toLocaleTimeString("en-US", options);
      currentDateElement.textContent = now.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" });
    }, 1000);

    // Update the current period and countdown based on the current time
    setInterval(() => {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();
      const currentSecond = now.getSeconds();

      // Find the current period
      const currentPeriodIndex = currentSchedule.findIndex(
        (period) =>
          currentHour * 60 * 60 + currentMinute * 60 + currentSecond >= period.start * 60 &&
          currentHour * 60 * 60 + currentMinute * 60 + currentSecond <= period.end * 60
      );

      if (currentPeriodIndex !== -1) {
        const currentPeriod = currentSchedule[currentPeriodIndex];
        const startHour = Math.floor(currentPeriod.start / 60);
        const startMinute = currentPeriod.start % 60;
        const endHour = Math.floor(currentPeriod.end / 60);
        const endMinute = currentPeriod.end % 60;
        currentPeriodElement.textContent = currentPeriod.name;

        // Find the next period
        const nextPeriodIndex = (currentPeriodIndex + 1) % currentSchedule.length;
        const nextPeriod = currentSchedule[nextPeriodIndex];
        const nextStartHour = Math.floor(nextPeriod.start / 60);
        const nextStartMinute = nextPeriod.start % 60;
        const timeDiff = nextPeriod.start * 60 - (currentHour * 60 * 60 + currentMinute * 60 + currentSecond);
        const minutes = Math.floor(timeDiff / 60);
        const seconds = timeDiff % 60;

        nextPeriodElement.textContent = `${nextPeriod.name}`;
        countdownElement.textContent = `${minutes} minutes ${seconds} seconds`;
      }
    }, 1000);

    // Create schedule list items dynamically
    currentSchedule.forEach((period) => {
      const listItem = document.createElement("li");
      listItem.className = "schedule-item";
      const startHour = Math.floor(period.start / 60);
      const startMinute = period.start % 60;
      const endHour = Math.floor(period.end / 60);
      const endMinute = period.end % 60;
      listItem.textContent = `${startHour}:${startMinute.toString().padStart(2, '0')} - ${endHour}:${endMinute.toString().padStart(2, '0')}: ${period.name}`;
      scheduleListElement.appendChild(listItem);
    });
  </script>
</body>
</html>
