<!DOCTYPE html>
<html>
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap" rel="stylesheet">
  <style>
    body {
      text-align: center; /* Center justify text */
      font-family: "Titillium Web", sans-serif;
      font-weight: 400;
      font-style: normal;
    }
    .schedule h2{
      margin-bottom: 0;
    }
    .schedule h1{
      margin-bottom: 0;
    }
    .schedule p{
      margin-bottom: 0;
    }
    .schedule {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .schedule-item {
      list-style-type: none; /* Remove bullet points */
      text-align: center; /* Center justify text */
      margin-bottom: 10px;
    }
    #schedule-list {
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* The switch - the box around the slider */
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    /* Hide default HTML checkbox */
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    /* The slider */
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }
    
    input:checked + .slider {
      background-color: #00B58B;
    }
    
    input:focus + .slider {
      box-shadow: 0 0 1px #2196F3;
    }
    
    input:checked + .slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }
    
    /* Rounded sliders */
    .slider.round {
      border-radius: 34px;
    }
    
    .slider.round:before {
      border-radius: 50%;
    }
    .slider-label {
      position: relative;
      left: 30px;
      top: 30px;
      border: 3px solid #73AD21;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <div class="schedule">
    <h1 id="current-timedate"></h1>
    <h1 id="current-period" style="font-size:40px";></h1>
    <p>Countdown to:</p>
    <h2 id="next-period"></h2>
    <h1 id="countdown"></h1>
    <h2>Today's Schedule:</h2>
    <ul id="schedule-list"></ul>
  </div>
  <div>
    <label class="switch">
      <input type="checkbox" id="24Hr switch" name="24Hr switch" value="24Hr switch" checked>
      <span class="slider round"></span>
    </label>
    <label for="24Hr switch" style="position: relative; left: 5px;  top: 20px;  width: 200px;  border: 0px solid #73AD21;"> 24Hr Time</label>
  </div>
  <script>
    const scheduleListElement = document.getElementById("schedule-list");
    const currentTimeDateElement = document.getElementById("current-timedate");
    const currentPeriodElement = document.getElementById("current-period");
    const nextPeriodElement = document.getElementById("next-period");
    const countdownElement = document.getElementById("countdown");
    // Your personal access token and base ID
    const accessToken = 'patITxf5DhDNa3n4Z.9c2b195a60fd2f5489ef4973cf5624d94c95b2f5bf1d1998705597187eaf5425'; // Replace with your actual API key
    const baseId = 'app5kCLxN9sVAY9wA'; // Replace with your actual base ID
    const tableName = 'AVMS_MinDays'; // Replace with your actual table name
    let dateList =[];
    
    // Airtable endpoint URL
    const endpoint = `https://api.airtable.com/v0/${baseId}/${tableName}`;
    
    // Function to fetch data from Airtable and extract the "Date" column into a list
    async function fetchDateList() {
      try {
        const response = await axios.get(endpoint, {
          headers: {
            'Authorization': `Bearer ${accessToken}`
          }
        });
        console.log(response); // Log the full response for debugging
        dateList = response.data.records.map(record => record.fields.Date); // Extracting "Date" column
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }
    
    async function initializeDateList() {
      await fetchDateList();
      console.log('Dates from Airtable:', dateList);
    };

    // Define the schedules for each day of the week
    const weeklySchedule = {
      "Monday": [
        { start: 9 * 60 + 45, end: 10 * 60 + 25, name: "First Period" },
        { start: 10 * 60 + 29, end: 11 * 60 + 9, name: "Second Period" },
        { start: 11 * 60 + 9, end: 11 * 60 + 21, name: "Break" },
        { start: 11 * 60 + 25, end: 12 * 60 + 5, name: "Third Period" },
        { start: 12 * 60 + 9, end: 12 * 60 + 49, name: "Fourth Period" },
        { start: 12 * 60 + 53, end: 13 * 60 + 22, name: "RISE" },
        { start: 13 * 60 + 22, end: 13 * 60 + 57, name: "Lunch" },
        { start: 14 * 60 + 1, end: 14 * 60 + 41, name: "Fifth Period" },
        { start: 14 * 60 + 45, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Tuesday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Wednesday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Thursday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" }
      ],
      "Friday": [
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" },
      ],
      "Minimum Day": [ //TEMP
        { start: 7 * 60 + 41, end: 8 * 60 + 41, name: "Zero Period" },
        { start: 8 * 60 + 45, end: 9 * 60 + 35, name: "First Period" },
        { start: 9 * 60 + 39, end: 10 * 60 + 29, name: "Second Period" },
        { start: 10 * 60 + 29, end: 10 * 60 + 40, name: "Break" },
        { start: 10 * 60 + 44, end: 11 * 60 + 34, name: "Third Period" },
        { start: 11 * 60 + 38, end: 12 * 60 + 28, name: "Fourth Period" },
        { start: 12 * 60 + 32, end: 13 * 60 + 2, name: "RISE" },
        { start: 13 * 60 + 2, end: 13 * 60 + 37, name: "Lunch" },
        { start: 13 * 60 + 41, end: 14 * 60 + 31, name: "Fifth Period" },
        { start: 14 * 60 + 35, end: 15 * 60 + 25, name: "Sixth Period" },
        { start: 15 * 60 + 25, name: "Sixth Period"}
      ],
      //... and so on for the rest of the week
    };

    // Get the current day of the week
    const now = new Date();
    let currentDay = "";

    // Gets the current date in ISO-8601 format
    const currentDate = now.toLocaleDateString("en-US", {year: "numeric"}) + "-" + now.toLocaleDateString("en-US", {month: "2-digit"}) + "-" + now.toLocaleDateString("en-US", {day: "2-digit"});

    async function getScheduleDay() {
      await initializeDateList();
      console.log("getScheduleDay");
      console.log(dateList);
      for (let i = 0; i < dateList.length; i++) {
        console.log(i);
        if (dateList[i] == currentDate) {
          console.log(dateList[i] + currentDate);
          return("Minimum Day");
        }
      }
      if (currentDay !== "Minimum Day") {
        return(now.toLocaleDateString("en-US", { weekday: "long" }));
      }
    }

    // Update the current time every second
    setInterval(() => {
      const now = new Date();
      const options = { hour: "2-digit", minute: "2-digit", second: "2-digit" };
      currentTimeDateElement.textContent = now.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" }) + " " + now.toLocaleTimeString("en-US", options);
    }, 1000);
    
    getScheduleDay().then((currentDay) => {
      console.log(currentDay);
      // Get the schedule for the current day
      const currentSchedule = weeklySchedule[currentDay];
  
      // Update the current period and countdown based on the current time
      setInterval(() => {
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentSecond = now.getSeconds();
      
        // Find the current period
        const currentPeriodIndex = currentSchedule.findIndex(
          (period) =>
            currentHour * 60 * 60 + currentMinute * 60 + currentSecond >= period.start * 60 &&
            currentHour * 60 * 60 + currentMinute * 60 + currentSecond <= period.end * 60
        );
      
        if (currentPeriodIndex !== -1) {
          const currentPeriod = currentSchedule[currentPeriodIndex];
          const startHour = Math.floor(currentPeriod.start / 60);
          const startMinute = currentPeriod.start % 60;
          const endHour = Math.floor(currentPeriod.end / 60);
          const endMinute = currentPeriod.end % 60;
          currentPeriodElement.textContent = currentPeriod.name;
      
          // Find the next period
          const nextPeriodIndex = (currentPeriodIndex + 1) % currentSchedule.length;
          const nextPeriod = currentSchedule[nextPeriodIndex];
          const nextStartHour = Math.floor(nextPeriod.start / 60);
          const nextStartMinute = nextPeriod.start % 60;
          const timeDiff = nextPeriod.start * 60 - (currentHour * 60 * 60 + currentMinute * 60 + currentSecond);
          const minutes = Math.floor(timeDiff / 60);
          const seconds = timeDiff % 60;
      
          nextPeriodElement.textContent = `${nextPeriod.name}`;
          countdownElement.textContent = `${minutes} minutes ${seconds} seconds`;
        } else {
          // console.log(`Current time: ${currentHour}:${currentMinute}`);
          // console.log(`Last period end time: ${currentSchedule[currentSchedule.length - 1].end}`);
          if (currentHour * 60 + currentMinute >= currentSchedule[currentSchedule.length - 1].end) {
            currentPeriodElement.textContent = "End of School";
          } else {
            currentPeriodElement.textContent = "Passing";
          }
        }
      }, 1000);
  
  
      // Create schedule list items dynamically
      currentSchedule.forEach((period) => {
        const listItem = document.createElement("li");
        listItem.className = "schedule-item";
        const startHour = Math.floor(period.start / 60);
        const startMinute = period.start % 60;
        const endHour = Math.floor(period.end / 60);
        const endMinute = period.end % 60;
        listItem.textContent = `${startHour}:${startMinute.toString().padStart(2, '0')} - ${endHour}:${endMinute.toString().padStart(2, '0')}: ${period.name}`;
        scheduleListElement.appendChild(listItem);
      });
    });
  </script>
</body>
</html>
